<div class="dashboard">
  <div class="split">
    <div class="section user-info">
      <div class="container">
        <h2>User</h2>
        <p>Currently logged in as: {{currentUser?.user_name}}</p>
        <p>Currently subscribed to X records</p>
        <button class="margin">Logout</button>
      </div>
    </div>
  
    <div class="section subscriptions">
      <div class="container subscriptions-container">
        @if (subscriptionsLoading) {
          <div class="loading">
            <svg width="48" height="48" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><style>.spinner_P7sC{transform-origin:center;animation:spinner_svv2 .75s infinite linear}@keyframes spinner_svv2{100%{transform:rotate(360deg)}}</style><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_P7sC"/></svg>
          </div>
        }
        @else {
          <div class="refresh-subscriptions">
            <h2>Subscriptions</h2>
            <button class="refresh-button" (click)="refreshSubscriptions()">
              <svg xmlns="http://www.w3.org/2000/svg"  width="24px" height="24px" viewBox="0 0 24 24" fill="#000000"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
            </button>
          </div>
          
          @if (userSubscriptions.length) {
            <div class="music-results-container">
              <app-subscription-results 
                [ngStyle]="{'display': 'contents'}" 
                [musicItems]="userSubscriptions"
                (unsubscribeEmitter)="handleUnsubscribe($event)">
              </app-subscription-results>
            </div>
          }
          @else {
            <p>Currently no subscriptions... Add some with a query?</p>
          }
        }
      </div>
    </div>
  </div>

  <div class="section query">
      <div class="container query-container">
        @if (queryLoading) {
          <div class="loading">
            <svg width="48" height="48" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><style>.spinner_P7sC{transform-origin:center;animation:spinner_svv2 .75s infinite linear}@keyframes spinner_svv2{100%{transform:rotate(360deg)}}</style><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_P7sC"/></svg>
          </div>
        }
        @else {
          <h2>Query</h2>
          <div class="query-section margin">
            <form [formGroup]="queryForm" (ngSubmit)="onSubmit()">
              <input formControlName="title" placeholder="Title">
              <input formControlName="artist" placeholder="Artist">
              <input formControlName="year" type="number" placeholder="Year">
              <button type="submit">
                <span>Submit</span>
              </button>
            </form>
          </div>
          @if (queryResults.length && !emptyQuery) {
            <div class="music-results-container">
              <app-music-results 
                [ngStyle]="{'display': 'contents'}" 
                [musicItems]="queryResults"
                [processedMusicItem]="processedMusicItem"
                (subscribeEmitter)="handleSubscribed($event)">
              </app-music-results>
            </div>
          }
          @else if (emptyQuery) {
            <p>No result is retrieved. Please query again.</p>
          }
        }
      </div>
    </div>
</div>